<!DOCTYPE html>
<html>

<head>
  <title>æ¨¡çµ„çµæ§‹æ¸¬è©¦ V2</title>
</head>

<body>
  <h1>AkingSPICEæ¨¡çµ„çµæ§‹æ¸¬è©¦ V2</h1>
  <div id="log"></div>

  <script type="module">
    function log(msg) {
      console.log(msg);
      document.getElementById('log').innerHTML += '<p>' + new Date().toLocaleTimeString() + ': ' + msg + '</p>';
    }

    log('é–‹å§‹æ¨¡çµ„çµæ§‹æ¸¬è©¦...');

    try {
      const module = await import('./lib-dist/AkingSPICE.es.js');
      log('âœ… æ¨¡çµ„è¼‰å…¥æˆåŠŸ');

      // æª¢æŸ¥å¯ç”¨çš„çµ„ä»¶
      log('å¯ç”¨çµ„ä»¶: ' + Object.keys(module).join(', '));

      // å˜—è©¦ç›´æ¥è¨ªå•VoltageSource
      if (module.VoltageSource) {
        log('âœ… æ‰¾åˆ°VoltageSourceçµ„ä»¶');
        try {
          const vs = new module.VoltageSource('V1', [1, 0], 5.0);
          log('âœ… æˆåŠŸå‰µå»ºé›»å£“æº: ' + vs.name + ', å€¼: ' + vs.value + 'V');
        } catch (err) {
          log('âŒ å‰µå»ºé›»å£“æºå¤±æ•—: ' + err.message);
        }
      } else {
        log('âŒ æ²’æœ‰æ‰¾åˆ°VoltageSource');
      }

      // å˜—è©¦è¨ªå•ExplicitStateSolver
      if (module.ExplicitStateSolver) {
        log('âœ… æ‰¾åˆ°ExplicitStateSolver');
        try {
          const solver = new module.ExplicitStateSolver();
          log('âœ… æˆåŠŸå‰µå»ºæ±‚è§£å™¨');

          // å˜—è©¦é‹è¡Œä¸€å€‹ç°¡å–®çš„é›»è·¯
          const components = [];
          if (module.VoltageSource && module.Resistor && module.Capacitor) {
            components.push(new module.VoltageSource('V1', [1, 0], 5.0));
            components.push(new module.Resistor('R1', [1, 2], 1000));
            components.push(new module.Capacitor('C1', [2, 0], 1e-6));

            log('âœ… å‰µå»ºäº†' + components.length + 'å€‹çµ„ä»¶');

            // å˜—è©¦åˆå§‹åŒ–æ±‚è§£å™¨
            try {
              await solver.initialize(components, 1e-6);
              log('âœ… æ±‚è§£å™¨åˆå§‹åŒ–æˆåŠŸ');

              // é‹è¡Œå¹¾å€‹æ­¥é©Ÿ
              for (let i = 0; i < 3; i++) {
                const result = solver.step();
                const vOut = result.nodeVoltages[2] || 0;
                log(`æ­¥é©Ÿ ${i + 1}: V_out = ${vOut.toFixed(3)}V`);
              }
              log('ğŸ‰ å®Œæ•´æ¸¬è©¦æˆåŠŸï¼');

            } catch (err) {
              log('âŒ æ±‚è§£å™¨åˆå§‹åŒ–å¤±æ•—: ' + err.message);
            }
          } else {
            log('âŒ ç¼ºå°‘å¿…è¦çš„çµ„ä»¶é¡');
          }
        } catch (err) {
          log('âŒ å‰µå»ºæ±‚è§£å™¨å¤±æ•—: ' + err.message);
        }
      } else {
        log('âŒ æ²’æœ‰æ‰¾åˆ°ExplicitStateSolver');
      }

    } catch (error) {
      log('âŒ æ¸¬è©¦å¤±æ•—: ' + error.message);
      console.error('è©³ç´°éŒ¯èª¤:', error);
    }
  </script>
</body>

</html>