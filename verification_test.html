<!DOCTYPE html>
<html>
<head>
    <title>AkingSPICEä¿®å¾©é©—è­‰</title>
</head>
<body>
    <h1>AkingSPICEä¿®å¾©é©—è­‰æ¸¬è©¦</h1>
    <div id="output"></div>

    <script src="lib-dist/AkingSPICE.umd.js"></script>
    <script>
        let output = document.getElementById('output');

        function log(message) {
            console.log(message);
            output.innerHTML += message + '<br>';
        }

        async function runTests() {
            try {
                log('ğŸ§ª é–‹å§‹AkingSPICEä¿®å¾©é©—è­‰...');
                
                if (!window.AkingSPICE) {
                    log('âŒ AkingSPICEæœªåŠ è¼‰');
                    return;
                }
                
                const { VoltageSource, Resistor, Capacitor, ExplicitStateSolver } = window.AkingSPICE;
                
                // æ¸¬è©¦ 1: åŸºæœ¬æ­å§†å®šå¾‹ (5V + 10Î©)
                log('\nğŸ“Š æ¸¬è©¦ 1: åŸºæœ¬æ­å§†å®šå¾‹ (5Vé›»å£“æº + 10Î©é›»é˜»)');
                
                const v1 = new VoltageSource('V1', ['vin', 'gnd'], 5.0);
                const r1 = new Resistor('R1', ['vin', 'gnd'], 10);
                
                const solver1 = new ExplicitStateSolver([v1, r1]);
                solver1.step(1e-6);
                
                const result1 = solver1.getNodeVoltages();
                const vinVoltage = result1.vin || 0;
                const error1 = Math.abs(vinVoltage - 5.0);
                
                log(`  çµæœ: V(vin) = ${vinVoltage.toFixed(6)}V (æœŸæœ›: 5.000000V)`);
                log(`  èª¤å·®: ${error1.toExponential(3)}V`);
                
                if (error1 < 0.01) {
                    log('  âœ… æ¸¬è©¦1é€šé - åŸºæœ¬æ­å§†å®šå¾‹æ­£ç¢º');
                } else {
                    log('  âŒ æ¸¬è©¦1å¤±æ•— - åŸºæœ¬é›»é˜»è¨ˆç®—æœ‰å•é¡Œ');
                }
                
                // æ¸¬è©¦ 2: RCé›»è·¯å……é›»
                log('\nğŸ“Š æ¸¬è©¦ 2: RCå……é›»é›»è·¯ (5V, 1kÎ©, 1ÂµF)');
                
                const v2 = new VoltageSource('V1', ['vin', 'gnd'], 5.0);
                const r2 = new Resistor('R1', ['vin', 'node1'], 1000);
                const c2 = new Capacitor('C1', ['node1', 'gnd'], 1e-6);
                
                const solver2 = new ExplicitStateSolver([v2, r2, c2]);
                
                // åŸ·è¡Œ5æ­¥å……é›»éç¨‹
                let previousVc = 0;
                for (let i = 0; i < 5; i++) {
                    solver2.step(1e-6);
                    
                    const result2 = solver2.getNodeVoltages();
                    const stateVars = solver2.getStateVariables();
                    
                    const t = solver2.currentTime;
                    const Vc = stateVars.C1 || 0;
                    const Vnode1 = result2.node1 || 0;
                    
                    // ç†è«–å€¼: Vc(t) = 5 * (1 - exp(-t/Ï„)), Ï„ = RC = 1ms
                    const tau = 1000 * 1e-6; // 1ms
                    const theoretical = 5 * (1 - Math.exp(-t / tau));
                    const error2 = Math.abs(Vc - theoretical);
                    
                    log(`  t=${(t*1e6).toFixed(1)}Âµs: Vc=${Vc.toFixed(6)}V, Vnode1=${Vnode1.toFixed(6)}V`);
                    log(`    ç†è«–Vc=${theoretical.toFixed(6)}V, èª¤å·®=${error2.toExponential(3)}V`);
                    
                    // æª¢æŸ¥ç‰©ç†åˆç†æ€§
                    if (Vc > previousVc && Vc <= 5.0) {
                        log(`    âœ… é›»å®¹é›»å£“å–®èª¿éå¢ä¸”åˆç†`);
                    } else {
                        log(`    âŒ é›»å®¹é›»å£“è®ŠåŒ–ç•°å¸¸`);
                    }
                    
                    previousVc = Vc;
                }
                
                // æ¸¬è©¦ 3: æ•¸å€¼ç©©å®šæ€§æª¢æŸ¥
                log('\nğŸ“Š æ¸¬è©¦ 3: æ•¸å€¼ç©©å®šæ€§æª¢æŸ¥');
                
                const finalVc = solver2.getStateVariables().C1 || 0;
                if (finalVc > 0 && finalVc < 5 && !isNaN(finalVc) && isFinite(finalVc)) {
                    log(`  âœ… æ•¸å€¼ç©©å®š - æœ€çµ‚Vc=${finalVc.toFixed(6)}V`);
                } else {
                    log(`  âŒ æ•¸å€¼ä¸ç©©å®š - Vc=${finalVc}`);
                }
                
                log('\nğŸ¯ ç¸½çµ:');
                if (error1 < 0.01 && finalVc > 0 && finalVc < 5) {
                    log('âœ… æ ¸å¿ƒä¿®å¾©æˆåŠŸ - AkingSPICEåŸºæœ¬åŠŸèƒ½æ­£å¸¸');
                    log('ğŸš€ å¯ä»¥é€²è¡ŒLLCé›»è·¯æ¨¡æ“¬');
                } else {
                    log('âŒ ä»æœ‰å•é¡Œéœ€è¦é€²ä¸€æ­¥ä¿®å¾©');
                    log(`   - åŸºæœ¬æ­å§†å®šå¾‹èª¤å·®: ${error1.toExponential(3)}`);
                    log(`   - RCé›»è·¯æœ€çµ‚ç‹€æ…‹: Vc=${finalVc}`);
                }
                
            } catch (error) {
                log('âŒ æ¸¬è©¦éç¨‹éŒ¯èª¤: ' + error.message);
                console.error(error);
            }
        }

        // é é¢åŠ è¼‰å®Œæˆå¾Œè‡ªå‹•é‹è¡Œæ¸¬è©¦
        window.addEventListener('load', () => {
            setTimeout(runTests, 500);
        });
    </script>
</body>
</html>