<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>LLCä½¿ç”¨æ¨™æº–AkingSPICE</title>
  <style>
    body {
      font-family: Arial;
      padding: 20px;
      background: #2c3e50;
      color: white;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.1);
      padding: 20px;
      border-radius: 10px;
    }

    .metrics {
      display: flex;
      gap: 15px;
      margin: 20px 0;
      flex-wrap: wrap;
    }

    .metric {
      background: rgba(255, 255, 255, 0.1);
      padding: 12px;
      border-radius: 6px;
      text-align: center;
      flex: 1;
      min-width: 120px;
    }

    .metric-label {
      font-size: 11px;
      opacity: 0.8;
      margin-bottom: 4px;
    }

    .metric-value {
      font-size: 18px;
      font-weight: bold;
      color: #27ae60;
    }

    #log {
      height: 400px;
      overflow-y: auto;
      background: rgba(0, 0, 0, 0.4);
      padding: 15px;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      margin-top: 20px;
    }

    .success {
      color: #27ae60;
    }

    .error {
      color: #e74c3c;
    }

    .warning {
      color: #f39c12;
    }

    .info {
      color: #3498db;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>âš¡ LLCä½¿ç”¨æ¨™æº–AkingSPICE</h1>
    <p>ğŸ¯ å˜—è©¦ä½¿ç”¨æ¨™æº–AkingSPICEæ±‚è§£å™¨è€ŒéExplicitStateSolver</p>

    <div class="metrics">
      <div class="metric">
        <div class="metric-label">æ±‚è§£å™¨ç‹€æ…‹</div>
        <div id="status" class="metric-value">åˆå§‹åŒ–ä¸­</div>
      </div>
      <div class="metric">
        <div class="metric-label">åˆ†æé¡å‹</div>
        <div id="analysis" class="metric-value">DC</div>
      </div>
      <div class="metric">
        <div class="metric-label">ç¯€é»æ•¸</div>
        <div id="nodes" class="metric-value">0</div>
      </div>
      <div class="metric">
        <div class="metric-label">çµ„ä»¶æ•¸</div>
        <div id="components" class="metric-value">0</div>
      </div>
      <div class="metric">
        <div class="metric-label">è¼¸å‡ºé›»å£“</div>
        <div id="vout" class="metric-value">0V</div>
      </div>
    </div>

    <h3>ğŸ“‹ æ¨™æº–AkingSPICEæ±‚è§£å™¨æ—¥èªŒ</h3>
    <div id="log">æº–å‚™ä½¿ç”¨æ¨™æº–AkingSPICE...<br></div>
  </div>

  <script src="./lib-dist/AkingSPICE.umd.js"></script>

  <script>
    function log(message, type = 'info') {
      const colors = {
        'success': '#27ae60',
        'error': '#e74c3c',
        'warning': '#f39c12',
        'info': '#3498db'
      };

      const time = new Date().toLocaleTimeString();
      const logElement = document.getElementById('log');
      logElement.innerHTML += `<span style="color: ${colors[type]};">[${time}] ${message}</span><br>`;
      logElement.scrollTop = logElement.scrollHeight;
    }

    function updateMetric(id, value) {
      document.getElementById(id).textContent = value;
    }

    // ç«‹å³åŸ·è¡Œ
    document.addEventListener('DOMContentLoaded', function () {
      log('âš¡ LLCæ¨™æº–AkingSPICEç‰ˆæœ¬å•Ÿå‹•', 'success');

      if (!window.AkingSPICE) {
        log('âŒ AkingSPICEæœªè¼‰å…¥', 'error');
        updateMetric('status', 'éŒ¯èª¤');
        return;
      }

      log('âœ… AkingSPICEæ¨¡å¡Šè¼‰å…¥æˆåŠŸ', 'success');

      // æª¢æŸ¥å¯ç”¨çš„é¡
      const spice = window.AkingSPICE;
      log('ğŸ“¦ æª¢æŸ¥AkingSPICEå¯ç”¨çµ„ä»¶:', 'info');

      for (const key in spice) {
        if (typeof spice[key] === 'function') {
          log(`  - ${key}: ${typeof spice[key]}`, 'info');
        }
      }

      try {
        // æ–¹æ³•1: å˜—è©¦ä½¿ç”¨ä¸»AkingSPICEé¡
        if (spice.AkingSPICE) {
          log('ğŸ§ª æ–¹æ³•1: ä½¿ç”¨ä¸»AkingSPICEé¡', 'info');

          const solver = new spice.AkingSPICE();
          log('âœ… AkingSPICEå¯¦ä¾‹å‰µå»ºæˆåŠŸ', 'success');

          // æª¢æŸ¥å¯ç”¨æ–¹æ³•
          log('ğŸ” æª¢æŸ¥AkingSPICEå¯¦ä¾‹æ–¹æ³•:', 'info');
          for (const method in solver) {
            if (typeof solver[method] === 'function') {
              log(`  æ–¹æ³•: ${method}`, 'info');
            }
          }

          updateMetric('status', 'æˆåŠŸ');

        } else {
          log('âŒ æ‰¾ä¸åˆ°ä¸»AkingSPICEé¡', 'error');
        }

        // æ–¹æ³•2: å˜—è©¦DCAnalysis
        if (spice.DCAnalysis) {
          log('ğŸ§ª æ–¹æ³•2: ä½¿ç”¨DCAnalysis', 'info');

          const dcSolver = new spice.DCAnalysis();
          log('âœ… DCAnalysiså‰µå»ºæˆåŠŸ', 'success');

          updateMetric('analysis', 'DCåˆ†æ');
        }

        // æ–¹æ³•3: æª¢æŸ¥TransientAnalysis
        if (spice.TransientAnalysis) {
          log('ğŸ§ª æ–¹æ³•3: TransientAnalysiså¯ç”¨', 'info');
          updateMetric('analysis', 'ç¬æ…‹åˆ†æ');
        }

        // æ–¹æ³•4: å˜—è©¦å‰µå»ºåŸºæœ¬LLCé›»è·¯ä½¿ç”¨ç¶²è¡¨
        log('ğŸ”§ æ–¹æ³•4: å˜—è©¦ç¶²è¡¨æ–¹å¼å‰µå»ºLLC', 'info');

        const llcNetlist = `
LLCè«§æŒ¯è½‰æ›å™¨æ¸¬è©¦
* LLCé›»è·¯ç¶²è¡¨
Vin 1 0 DC 12V
Lr 1 2 10mH
Cr 2 3 1uF
Rload 3 0 50
.dc vin 0 12 1
.end
        `;

        log('ğŸ“ å‰µå»ºLLCç¶²è¡¨:', 'info');
        log('   Vin: 12V DCé›»æº (ç¯€é»1åˆ°åœ°)', 'info');
        log('   Lr: 10mH è«§æŒ¯é›»æ„Ÿ (ç¯€é»1åˆ°2)', 'info');
        log('   Cr: 1Î¼F è«§æŒ¯é›»å®¹ (ç¯€é»2åˆ°3)', 'info');
        log('   Rload: 50Î© è² è¼‰ (ç¯€é»3åˆ°åœ°)', 'info');

        if (spice.AkingSPICE) {
          const netlistSolver = new spice.AkingSPICE(llcNetlist);
          log('âœ… ç¶²è¡¨æ±‚è§£å™¨å‰µå»ºæˆåŠŸ', 'success');

          // å˜—è©¦é‹è¡Œåˆ†æ
          if (typeof netlistSolver.run === 'function') {
            log('ğŸš€ åŸ·è¡Œåˆ†æ...', 'info');
            const result = netlistSolver.run();

            if (result) {
              log('âœ… åˆ†æå®Œæˆ', 'success');
              log(`çµæœé¡å‹: ${typeof result}`, 'info');

              if (result.nodeVoltages) {
                log('ğŸ“Š ç¯€é»é›»å£“:', 'success');
                for (const node in result.nodeVoltages) {
                  log(`  ç¯€é»${node}: ${result.nodeVoltages[node].toFixed(3)}V`, 'success');
                }

                // æ›´æ–°é¡¯ç¤º
                const v3 = result.nodeVoltages[3] || 0;
                updateMetric('vout', v3.toFixed(2) + 'V');

              } else {
                log('âš ï¸ çµæœä¸­æ²’æœ‰ç¯€é»é›»å£“ä¿¡æ¯', 'warning');
              }
            } else {
              log('âŒ åˆ†æè¿”å›ç©ºçµæœ', 'error');
            }
          } else {
            log('âŒ æ±‚è§£å™¨æ²’æœ‰runæ–¹æ³•', 'error');
          }
        }

        // æ–¹æ³•5: å˜—è©¦ç›´æ¥çµ„ä»¶æ–¹å¼
        log('ğŸ”§ æ–¹æ³•5: ç›´æ¥çµ„ä»¶æ–¹å¼', 'info');

        const { VoltageSource, Resistor, Capacitor, Inductor } = spice;

        const components = [
          new VoltageSource('Vin', [1, 0], 12.0),
          new Inductor('Lr', [1, 2], 10e-3),
          new Capacitor('Cr', [2, 3], 1e-6),
          new Resistor('Rload', [3, 0], 50.0)
        ];

        log(`âœ… å‰µå»º${components.length}å€‹çµ„ä»¶`, 'success');
        updateMetric('components', components.length);
        updateMetric('nodes', '4');

        // æª¢æŸ¥çµ„ä»¶å±¬æ€§
        components.forEach((comp, i) => {
          log(`  çµ„ä»¶${i + 1}: ${comp.name} ${comp.type} ç¯€é»[${comp.nodes.join(',')}]`, 'info');
        });

        if (spice.AkingSPICE) {
          const componentSolver = new spice.AkingSPICE();
          componentSolver.components = components;

          log('âœ… çµ„ä»¶è¨­ç½®åˆ°æ±‚è§£å™¨', 'success');

          // å˜—è©¦è¨­ç½®åˆ†æ
          if (typeof componentSolver.addAnalysis === 'function') {
            componentSolver.addAnalysis('.dc vin 0 12 1');
            log('âœ… DCåˆ†æè¨­ç½®å®Œæˆ', 'success');
          }
        }

        log('ğŸ‰ æ¨™æº–AkingSPICEæ¸¬è©¦å®Œæˆ', 'success');
        updateMetric('status', 'å®Œæˆ');

      } catch (error) {
        log(`âŒ åŸ·è¡ŒéŒ¯èª¤: ${error.message}`, 'error');
        log(`éŒ¯èª¤è©³ç´°: ${error.stack}`, 'error');
        updateMetric('status', 'éŒ¯èª¤');
      }
    });

  </script>
</body>

</html>