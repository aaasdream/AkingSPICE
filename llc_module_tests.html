<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>LLCå­é›»è·¯æ¨¡çµ„æ¸¬è©¦</title>
  <style>
    body {
      font-family: Arial;
      padding: 20px;
      background: #2c3e50;
      color: white;
    }

    .container {
      max-width: 1000px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.1);
      padding: 20px;
      border-radius: 10px;
    }

    .test-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin: 20px 0;
    }

    .test-module {
      background: rgba(255, 255, 255, 0.05);
      padding: 15px;
      border-radius: 8px;
      border: 1px solid #555;
    }

    .test-module h3 {
      margin-top: 0;
      color: #3498db;
    }

    .status {
      font-weight: bold;
      padding: 5px 10px;
      border-radius: 4px;
      margin: 5px 0;
    }

    .status.success {
      background: #27ae60;
    }

    .status.fail {
      background: #e74c3c;
    }

    .status.testing {
      background: #f39c12;
    }

    #log {
      height: 300px;
      overflow-y: auto;
      background: rgba(0, 0, 0, 0.4);
      padding: 15px;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      margin-top: 20px;
    }

    .success {
      color: #27ae60;
    }

    .error {
      color: #e74c3c;
    }

    .warning {
      color: #f39c12;
    }

    .info {
      color: #3498db;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>ğŸ”§ LLCå­é›»è·¯æ¨¡çµ„æ¸¬è©¦</h1>
    <p>é€ä¸€æ¸¬è©¦LLCè½‰æ›å™¨æ‰€éœ€çš„å„å€‹é›»è·¯æ¨¡çµ„</p>

    <div class="test-grid">
      <div class="test-module">
        <h3>1. æ•´æµé›»è·¯ (äºŒæ¥µé«”)</h3>
        <div id="status1" class="status testing">æ¸¬è©¦ä¸­...</div>
        <div id="result1">ç­‰å¾…æ¸¬è©¦çµæœ</div>
      </div>

      <div class="test-module">
        <h3>2. MOSFETé–‹é—œ</h3>
        <div id="status2" class="status testing">æ¸¬è©¦ä¸­...</div>
        <div id="result2">ç­‰å¾…æ¸¬è©¦çµæœ</div>
      </div>

      <div class="test-module">
        <h3>3. è®Šå£“å™¨ (è€¦åˆé›»æ„Ÿ)</h3>
        <div id="status3" class="status testing">æ¸¬è©¦ä¸­...</div>
        <div id="result3">ç­‰å¾…æ¸¬è©¦çµæœ</div>
      </div>

      <div class="test-module">
        <h3>4. è«§æŒ¯é›»è·¯ (L-C)</h3>
        <div id="status4" class="status testing">æ¸¬è©¦ä¸­...</div>
        <div id="result4">ç­‰å¾…æ¸¬è©¦çµæœ</div>
      </div>

      <div class="test-module">
        <h3>5. è¼¸å‡ºæ•´æµ (å…¨æ³¢æ•´æµ)</h3>
        <div id="status5" class="status testing">æ¸¬è©¦ä¸­...</div>
        <div id="result5">ç­‰å¾…æ¸¬è©¦çµæœ</div>
      </div>

      <div class="test-module">
        <h3>6. å®Œæ•´LLCçµ„åˆ</h3>
        <div id="status6" class="status testing">æ¸¬è©¦ä¸­...</div>
        <div id="result6">ç­‰å¾…æ¸¬è©¦çµæœ</div>
      </div>
    </div>

    <h3>ğŸ“‹ è©³ç´°æ¸¬è©¦æ—¥èªŒ</h3>
    <div id="log">é–‹å§‹LLCå­æ¨¡çµ„æ¸¬è©¦...<br></div>
  </div>

  <script src="./lib-dist/AkingSPICE.umd.js"></script>

  <script>
    function log(message, type = 'info') {
      const colors = {
        'success': '#27ae60',
        'error': '#e74c3c',
        'warning': '#f39c12',
        'info': '#3498db'
      };

      const time = new Date().toLocaleTimeString();
      const logElement = document.getElementById('log');
      logElement.innerHTML += `<span style="color: ${colors[type]};">[${time}] ${message}</span><br>`;
      logElement.scrollTop = logElement.scrollHeight;
    }

    function updateStatus(testNum, status, result) {
      const statusElement = document.getElementById(`status${testNum}`);
      const resultElement = document.getElementById(`result${testNum}`);

      statusElement.className = `status ${status}`;
      statusElement.textContent = status === 'success' ? 'âœ… é€šé' : status === 'fail' ? 'âŒ å¤±æ•—' : 'ğŸ”„ æ¸¬è©¦ä¸­';
      resultElement.textContent = result;
    }

    async function testModule(testNum, name, testFunction) {
      log(`ğŸ§ª æ¸¬è©¦ ${testNum}: ${name}`, 'info');
      updateStatus(testNum, 'testing', 'åŸ·è¡Œä¸­...');

      try {
        const result = await testFunction();
        log(`âœ… æ¸¬è©¦ ${testNum} é€šé: ${result}`, 'success');
        updateStatus(testNum, 'success', result);
        return true;
      } catch (error) {
        log(`âŒ æ¸¬è©¦ ${testNum} å¤±æ•—: ${error.message}`, 'error');
        updateStatus(testNum, 'fail', error.message);
        return false;
      }
    }

    document.addEventListener('DOMContentLoaded', async function () {
      log('ğŸš€ é–‹å§‹LLCå­é›»è·¯æ¨¡çµ„æ¸¬è©¦', 'success');

      if (!window.AkingSPICE) {
        log('âŒ AkingSPICEæœªè¼‰å…¥', 'error');
        return;
      }

      const spice = window.AkingSPICE;
      const { VoltageSource, Resistor, Capacitor, Inductor, Diode, MOSFET, CoupledInductor, ExplicitStateSolver } = spice;

      // æ¸¬è©¦1: æ•´æµé›»è·¯
      await testModule(1, 'æ•´æµé›»è·¯ (äºŒæ¥µé«”)', async () => {
        const components = [
          new VoltageSource('Vac', [1, 0], 10.0),  // 10V ACæº
          new Diode('D1', [1, 2], { Is: 1e-14, n: 1.0 }),  // æ•´æµäºŒæ¥µé«”
          new Resistor('Rload', [2, 0], 100.0)     // è² è¼‰
        ];

        const solver = new ExplicitStateSolver();
        solver.initialize(components, 1e-5, { maxIterations: 50, tolerance: 1e-3 });

        // åŸ·è¡Œå¹¾æ­¥
        for (let i = 0; i < 5; i++) {
          solver.step();
        }

        return 'äºŒæ¥µé«”æ•´æµé›»è·¯æ­£å¸¸';
      });

      // æ¸¬è©¦2: MOSFETé–‹é—œ
      await testModule(2, 'MOSFETé–‹é—œ', async () => {
        const components = [
          new VoltageSource('Vdd', [1, 0], 12.0),   // ä¸»é›»æº
          new VoltageSource('Vgate', [3, 0], 5.0),  // é–˜æ¥µé©…å‹•
          new MOSFET('M1', [1, 2, 3], {
            type: 'nmos',
            W: 1e-3,     // å¯¬åº¦ 1mm
            L: 1e-6,     // é•·åº¦ 1Î¼m  
            Vth: 1.0,    // é–¾å€¼é›»å£“
            Cox: 3.45e-3 // æ°§åŒ–å±¤é›»å®¹
          }),
          new Resistor('Rd', [2, 0], 10.0)          // æ±²æ¥µè² è¼‰
        ];

        const solver = new ExplicitStateSolver();
        solver.initialize(components, 1e-5, { maxIterations: 50, tolerance: 1e-3 });

        for (let i = 0; i < 5; i++) {
          solver.step();
        }

        return 'MOSFETé–‹é—œé›»è·¯æ­£å¸¸';
      });

      // æ¸¬è©¦3: è®Šå£“å™¨ (è€¦åˆé›»æ„Ÿ)
      await testModule(3, 'è®Šå£“å™¨ (è€¦åˆé›»æ„Ÿ)', async () => {
        const components = [
          new VoltageSource('Vin', [1, 0], 12.0),
          new CoupledInductor('T1', {
            primary: { nodes: [1, 2], L: 1e-3 },    // åˆç´š 1mH
            secondary: { nodes: [3, 4], L: 4e-3 },  // æ¬¡ç´š 4mH (2:1åŒæ¯”)
            coupling: 0.95  // è€¦åˆä¿‚æ•¸
          }),
          new Resistor('Rpri', [2, 0], 1.0),       // åˆç´šé˜»æŠ—
          new Resistor('Rsec', [3, 4], 10.0)       // æ¬¡ç´šè² è¼‰
        ];

        const solver = new ExplicitStateSolver();
        solver.initialize(components, 1e-5, { maxIterations: 100, tolerance: 1e-3 });

        for (let i = 0; i < 3; i++) {
          solver.step();
        }

        return 'è®Šå£“å™¨è€¦åˆæ­£å¸¸';
      });

      // æ¸¬è©¦4: è«§æŒ¯é›»è·¯
      await testModule(4, 'è«§æŒ¯é›»è·¯ (L-C)', async () => {
        const components = [
          new VoltageSource('Vres', [1, 0], 10.0),
          new Inductor('Lr', [1, 2], 100e-6),      // è«§æŒ¯é›»æ„Ÿ 100Î¼H
          new Capacitor('Cr', [2, 3], 1e-6),       // è«§æŒ¯é›»å®¹ 1Î¼F
          new Resistor('Rres', [3, 0], 10.0)       // è«§æŒ¯é˜»æŠ—
        ];

        const solver = new ExplicitStateSolver();
        solver.initialize(components, 1e-6, { maxIterations: 50, tolerance: 1e-3 });

        for (let i = 0; i < 10; i++) {
          solver.step();
        }

        // è¨ˆç®—ç†è«–è«§æŒ¯é »ç‡
        const fr = 1 / (2 * Math.PI * Math.sqrt(100e-6 * 1e-6));
        return `è«§æŒ¯é›»è·¯æ­£å¸¸, frâ‰ˆ${(fr / 1000).toFixed(1)}kHz`;
      });

      // æ¸¬è©¦5: è¼¸å‡ºæ•´æµ
      await testModule(5, 'è¼¸å‡ºæ•´æµ (å…¨æ³¢æ•´æµ)', async () => {
        const components = [
          new VoltageSource('Vsec', [1, 0], 10.0),    // æ¬¡ç´šé›»å£“
          new Diode('D1', [1, 2], { Is: 1e-14, n: 1.0 }),
          new Diode('D2', [0, 2], { Is: 1e-14, n: 1.0 }),
          new Capacitor('Cout', [2, 0], 10e-6),      // è¼¸å‡ºé›»å®¹ 10Î¼F
          new Resistor('Rout', [2, 0], 50.0)         // è¼¸å‡ºè² è¼‰
        ];

        const solver = new ExplicitStateSolver();
        solver.initialize(components, 1e-5, { maxIterations: 50, tolerance: 1e-3 });

        for (let i = 0; i < 8; i++) {
          solver.step();
        }

        return 'å…¨æ³¢æ•´æµé›»è·¯æ­£å¸¸';
      });

      // æ¸¬è©¦6: ç°¡åŒ–LLCçµ„åˆ
      await testModule(6, 'å®Œæ•´LLCçµ„åˆ', async () => {
        const components = [
          // è¼¸å…¥éƒ¨åˆ†
          new VoltageSource('Vin', [1, 0], 48.0),   // 48Vè¼¸å…¥

          // è«§æŒ¯é›»è·¯
          new Inductor('Lr', [1, 2], 50e-6),        // è«§æŒ¯é›»æ„Ÿ 50Î¼H
          new Capacitor('Cr', [2, 3], 0.5e-6),      // è«§æŒ¯é›»å®¹ 0.5Î¼F

          // è®Šå£“å™¨ (ç°¡åŒ–ç‚ºé›»æ„Ÿ + é›»é˜»)
          new Inductor('Lm', [3, 4], 200e-6),       // æ¿€ç£é›»æ„Ÿ 200Î¼H
          new Resistor('Rtr', [4, 0], 0.1),         // è®Šå£“å™¨æè€—

          // è¼¸å‡ºæ•´æµ (ç°¡åŒ–)
          new Resistor('Rload', [3, 0], 20.0)       // ç­‰æ•ˆè² è¼‰
        ];

        const solver = new ExplicitStateSolver();
        solver.initialize(components, 5e-6, { maxIterations: 30, tolerance: 1e-2 });

        for (let i = 0; i < 5; i++) {
          const result = solver.step();
          log(`LLCæ­¥é©Ÿ ${i + 1}: V3=${result.nodeVoltages[3]?.toFixed(2)}V`, 'info');
        }

        return 'LLCåŸºæœ¬çµ„åˆé›»è·¯é‹è¡Œæ­£å¸¸';
      });

      log('ğŸ‰ æ‰€æœ‰LLCå­æ¨¡çµ„æ¸¬è©¦å®Œæˆï¼', 'success');
    });

  </script>
</body>

</html>