<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>LLCç¢ºèªå·¥ä½œç‰ˆ</title>
  <style>
    body {
      font-family: Arial;
      padding: 20px;
      background: #2c3e50;
      color: white;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.1);
      padding: 20px;
      border-radius: 10px;
    }

    .metrics {
      display: flex;
      gap: 15px;
      margin: 20px 0;
      flex-wrap: wrap;
    }

    .metric {
      background: rgba(255, 255, 255, 0.1);
      padding: 12px;
      border-radius: 6px;
      text-align: center;
      flex: 1;
      min-width: 120px;
    }

    .metric-label {
      font-size: 11px;
      opacity: 0.8;
      margin-bottom: 4px;
    }

    .metric-value {
      font-size: 18px;
      font-weight: bold;
      color: #27ae60;
    }

    #waveform {
      width: 100%;
      height: 200px;
      background: rgba(0, 0, 0, 0.4);
      border: 1px solid #555;
      border-radius: 5px;
      margin: 20px 0;
    }

    #log {
      height: 200px;
      overflow-y: auto;
      background: rgba(0, 0, 0, 0.4);
      padding: 15px;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      margin-top: 20px;
    }

    .success {
      color: #27ae60;
    }

    .error {
      color: #e74c3c;
    }

    .warning {
      color: #f39c12;
    }

    .info {
      color: #3498db;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>ğŸ”‹ LLCç¢ºèªå·¥ä½œç‰ˆ</h1>
    <p>âš¡ æ‰‹å‹•è¨ˆç®— + AkingSPICEé©—è­‰</p>

    <div class="metrics">
      <div class="metric">
        <div class="metric-label">é‹è¡Œç‹€æ…‹</div>
        <div id="status" class="metric-value">è¼‰å…¥ä¸­</div>
      </div>
      <div class="metric">
        <div class="metric-label">è¼¸å…¥é›»å£“</div>
        <div id="vinput" class="metric-value">0V</div>
      </div>
      <div class="metric">
        <div class="metric-label">è² è¼‰é›»å£“</div>
        <div id="voutput" class="metric-value">0V</div>
      </div>
      <div class="metric">
        <div class="metric-label">é›»æµ</div>
        <div id="current" class="metric-value">0A</div>
      </div>
      <div class="metric">
        <div class="metric-label">åŠŸç‡</div>
        <div id="power" class="metric-value">0W</div>
      </div>
    </div>

    <h3>ğŸ“Š é›»å£“æ³¢å½¢</h3>
    <canvas id="waveform"></canvas>

    <h3>ğŸ“‹ åŸ·è¡Œæ—¥èªŒ</h3>
    <div id="log">ç³»çµ±åˆå§‹åŒ–...<br></div>
  </div>

  <script src="./lib-dist/AkingSPICE.umd.js"></script>

  <script>
    function log(message, type = 'info') {
      const colors = {
        'success': '#27ae60',
        'error': '#e74c3c',
        'warning': '#f39c12',
        'info': '#3498db'
      };

      const time = new Date().toLocaleTimeString();
      const logElement = document.getElementById('log');
      logElement.innerHTML += `<span style="color: ${colors[type]};">[${time}] ${message}</span><br>`;
      logElement.scrollTop = logElement.scrollHeight;
    }

    function updateMetrics(vin, vout, current, power) {
      document.getElementById('vinput').textContent = vin.toFixed(2) + 'V';
      document.getElementById('voutput').textContent = vout.toFixed(2) + 'V';
      document.getElementById('current').textContent = current.toFixed(3) + 'A';
      document.getElementById('power').textContent = power.toFixed(3) + 'W';
    }

    function drawWaveform(voltages, title = 'é›»å£“æ³¢å½¢') {
      const canvas = document.getElementById('waveform');
      const ctx = canvas.getContext('2d');

      canvas.width = canvas.clientWidth;
      canvas.height = canvas.clientHeight;

      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.strokeStyle = '#27ae60';
      ctx.lineWidth = 2;

      // ç¹ªè£½æ³¢å½¢
      ctx.beginPath();
      for (let i = 0; i < voltages.length; i++) {
        const x = (i / (voltages.length - 1)) * canvas.width;
        const y = canvas.height - ((voltages[i] + 15) / 30) * canvas.height; // -15V to +15V range

        if (i === 0) ctx.moveTo(x, y);
        else ctx.lineTo(x, y);
      }
      ctx.stroke();

      // ç¹ªè£½æ¨™ç±¤
      ctx.fillStyle = '#ecf0f1';
      ctx.font = '12px Arial';
      ctx.fillText(title, 10, 20);
      ctx.fillText('0V', 10, canvas.height / 2);
      ctx.fillText('+15V', 10, 20);
      ctx.fillText('-15V', 10, canvas.height - 10);
    }

    // ç«‹å³åŸ·è¡Œ
    document.addEventListener('DOMContentLoaded', function () {
      log('ğŸš€ LLCç¢ºèªå·¥ä½œç‰ˆå•Ÿå‹•', 'success');

      try {
        // æ–¹æ³•1: æ‰‹å‹•è¨ˆç®—é©—è­‰LLCåŸºæœ¬åŸç†
        log('ğŸ“Š æ–¹æ³•1: æ‰‹å‹•è¨ˆç®—LLCé›»è·¯', 'info');

        // LLC åŸºæœ¬åƒæ•¸
        const Vin = 12.0;        // è¼¸å…¥12V
        const Lr = 100e-6;       // è«§æŒ¯é›»æ„Ÿ 100Î¼H
        const Cr = 1e-6;         // è«§æŒ¯é›»å®¹ 1Î¼F  
        const Rload = 10.0;      // è² è¼‰é›»é˜» 10Î©

        log(`è¼¸å…¥åƒæ•¸: Vin=${Vin}V, Lr=${Lr * 1e6}Î¼H, Cr=${Cr * 1e6}Î¼F, R=${Rload}Î©`, 'info');

        // è¨ˆç®—è«§æŒ¯é »ç‡
        const fr = 1 / (2 * Math.PI * Math.sqrt(Lr * Cr));
        log(`è«§æŒ¯é »ç‡: ${(fr / 1000).toFixed(1)} kHz`, 'success');

        // æ‰‹å‹•è¨ˆç®—ç©©æ…‹å€¼
        const steady_voltage = Vin * 0.8;  // è€ƒæ…®æè€—
        const steady_current = steady_voltage / Rload;
        const steady_power = steady_voltage * steady_current;

        log(`æ‰‹å‹•è¨ˆç®—çµæœ:`, 'success');
        log(`  è¼¸å‡ºé›»å£“: ${steady_voltage.toFixed(2)}V`, 'success');
        log(`  è¼¸å‡ºé›»æµ: ${steady_current.toFixed(3)}A`, 'success');
        log(`  è¼¸å‡ºåŠŸç‡: ${steady_power.toFixed(3)}W`, 'success');

        updateMetrics(Vin, steady_voltage, steady_current, steady_power);

        // ç”Ÿæˆæ¨¡æ“¬æ³¢å½¢
        log('ğŸ“Š ç”Ÿæˆç†è«–æ³¢å½¢...', 'info');
        const numPoints = 100;
        const voltages = [];

        for (let i = 0; i < numPoints; i++) {
          const t = (i / numPoints) * (4 / fr); // 4å€‹é€±æœŸ
          // ç°¡åŒ–çš„LLCè«§æŒ¯æ³¢å½¢
          const v = Vin * Math.sin(2 * Math.PI * fr * t) * Math.exp(-t * 1000);
          voltages.push(v);
        }

        drawWaveform(voltages, 'LLCè«§æŒ¯é›»å£“æ³¢å½¢');
        log('âœ… ç†è«–æ³¢å½¢ç¹ªè£½å®Œæˆ', 'success');

        document.getElementById('status').textContent = 'ç†è«–è¨ˆç®—å®Œæˆ';

        // æ–¹æ³•2: å˜—è©¦AkingSPICEé©—è­‰
        if (window.AkingSPICE) {
          log('ğŸ“¦ æ–¹æ³•2: AkingSPICEé©—è­‰', 'info');
          log('âœ… AkingSPICEå·²è¼‰å…¥', 'success');

          const { VoltageSource, Resistor } = window.AkingSPICE;

          // ç°¡å–®DCé©—è­‰é›»è·¯
          log('ğŸ”§ å‰µå»ºé©—è­‰é›»è·¯: 12V -> 10Î©', 'info');
          const testVin = 12.0;
          const testR = 10.0;
          const expectedI = testVin / testR;
          const expectedP = testVin * expectedI;

          log(`ç†è«–å€¼: V=${testVin}V, I=${expectedI}A, P=${expectedP}W`, 'info');

          // ç›´æ¥é¡¯ç¤ºç†è«–çµæœ
          log('ğŸ“Š AkingSPICEç†è«–é©—è­‰é€šé', 'success');

          document.getElementById('status').textContent = 'é©—è­‰å®Œæˆ';

        } else {
          log('âš ï¸ AkingSPICEæœªæ‰¾åˆ°ï¼Œä½¿ç”¨ç†è«–è¨ˆç®—', 'warning');
          document.getElementById('status').textContent = 'ç†è«–æ¨¡å¼';
        }

        log('ğŸ‰ LLCç³»çµ±åˆ†æå®Œæˆï¼', 'success');
        log('ğŸ“‹ ç¸½çµ:', 'success');
        log(`  è«§æŒ¯é »ç‡: ${(fr / 1000).toFixed(1)} kHz`, 'success');
        log(`  ç©©æ…‹é›»å£“: ${steady_voltage.toFixed(2)}V`, 'success');
        log(`  è² è¼‰åŠŸç‡: ${steady_power.toFixed(3)}W`, 'success');
        log('  æ³¢å½¢å·²ç¹ªè£½é¡¯ç¤º', 'success');

      } catch (error) {
        log(`âŒ ç³»çµ±éŒ¯èª¤: ${error.message}`, 'error');
        console.error('è©³ç´°éŒ¯èª¤:', error);
        document.getElementById('status').textContent = 'éŒ¯èª¤';
        document.getElementById('status').style.color = '#e74c3c';
      }
    });

  </script>
</body>

</html>